{{ template "header" . }}

<div class="h-full flex flex-col p-6 gap-6">
    <header class="flex justify-between items-center">
        <div>
            <h2 class="text-2xl font-bold text-white">Laporan Transaksi</h2>
            <p class="text-text-secondary">Riwayat penimbangan dan ekspor data</p>
        </div>

        <!-- Date Filter -->
        <form method="GET" action="/reports" class="flex gap-4 items-end">
            <div>
                <label class="block text-xs font-bold text-text-secondary mb-1">Dari Tanggal</label>
                <input type="date" name="start_date" value="{{ .StartDate }}" class="bg-background-dark border border-border-dark rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-primary">
            </div>
            <div>
                <label class="block text-xs font-bold text-text-secondary mb-1">Sampai Tanggal</label>
                <input type="date" name="end_date" value="{{ .EndDate }}" class="bg-background-dark border border-border-dark rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-primary">
            </div>
            <button type="submit" class="px-4 py-2 bg-surface-dark border border-border-dark hover:bg-card-hover text-white text-sm font-bold rounded-lg transition-colors">
                Filter
            </button>
            <button type="button" onclick="window.print()" class="px-4 py-2 bg-primary hover:bg-primary-hover text-white text-sm font-bold rounded-lg transition-colors flex items-center gap-2">
                <span class="material-symbols-outlined text-sm">print</span> Cetak
            </button>
        </form>
    </header>

    <style>
        @media print {
            @page {
                size: landscape;
                margin: 0;
            }
            body {
                background-color: white !important;
                color: black !important;
                margin: 1cm;
            }
            header, nav, aside, form, .no-print {
                display: none !important;
            }
            /* Reset Layout */
            .flex-col, .h-full, .p-6, .gap-6 {
                height: auto !important;
                padding: 0 !important;
                gap: 0 !important;
                display: block !important;
            }
            .bg-surface-dark {
                background-color: white !important;
                border: none !important;
            }
            .text-white, .text-text-secondary {
                color: black !important;
            }
            table {
                width: 100% !important;
                border-collapse: collapse;
            }
            th, td {
                border: 1px solid #000 !important;
                padding: 6px !important;
                font-size: 11pt !important;
                color: black !important;
            }
            thead {
                background-color: #eee !important;
                color: black !important;
                font-weight: bold;
                display: table-header-group;
            }
            tr {
                page-break-inside: avoid;
            }
            /* Hide Action Column */
            th:last-child, td:last-child {
                display: none !important;
            }
            /* Title for Print */
            .print-title {
                display: block !important;
                text-align: center;
                margin-bottom: 20px;
            }
            .print-title h1 {
                font-size: 18pt;
                font-weight: bold;
                margin: 0;
            }
            .print-title p {
                font-size: 10pt;
                margin: 5px 0 0;
            }
        }
        .print-title {
            display: none;
        }
    </style>

    <div class="print-title">
        <h1>LAPORAN TRANSAKSI PENIMBANGAN</h1>
        <p>Periode: {{ .StartDate }} s/d {{ .EndDate }}</p>
    </div>

    <!-- Report Table -->
    <div class="bg-surface-dark border border-border-dark rounded-xl flex-1 overflow-hidden flex flex-col">
        <div class="overflow-x-auto h-full">
            <table class="w-full text-left text-sm">
                <thead class="bg-card-dark text-text-secondary font-medium border-b border-border-dark sticky top-0">
                    <tr>
                        <th class="px-6 py-4">Waktu</th>
                        <th class="px-6 py-4">No. Tiket</th>
                        <th class="px-6 py-4">No. Polisi</th>
                        <th class="px-6 py-4">Supir</th>
                        <th class="px-6 py-4">Muatan</th>
                        <th class="px-6 py-4 text-right">Gross (kg)</th>
                        <th class="px-6 py-4 text-right">Tare (kg)</th>
                        <th class="px-6 py-4 text-right">Netto (kg)</th>
                        <th class="px-6 py-4 text-center">Aksi</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-border-dark overflow-y-auto">
                    {{ range .Records }}
                    <tr class="hover:bg-card-hover transition-colors">
                        <td class="px-6 py-4 text-text-secondary whitespace-nowrap">{{ .WeighedAt.Format "02 Jan 15:04" }}</td>
                        <td class="px-6 py-4 font-mono text-xs">{{ .TicketNumber }}</td>
                        <td class="px-6 py-4 font-medium text-white">{{ .PlateNumber }}</td>
                        <td class="px-6 py-4">{{ .DriverName }}</td>
                        <td class="px-6 py-4">{{ .Product }}</td>
                        <td class="px-6 py-4 text-right font-mono">{{ printf "%.0f" .GrossWeight }}</td>
                        <td class="px-6 py-4 text-right font-mono text-text-secondary">{{ printf "%.0f" .TareWeight }}</td>
                        <td class="px-6 py-4 text-right font-mono font-bold text-success">{{ printf "%.0f" .NetWeight }}</td>
                        <td class="px-6 py-4 text-center">
                            {{ if .InvoicePath }}
                            <a href="/{{ .InvoicePath }}" target="_blank" class="inline-flex items-center justify-center w-8 h-8 rounded hover:bg-white/10 text-primary" title="Lihat PDF">
                                <span class="material-symbols-outlined text-lg">description</span>
                            </a>
                            {{ end }}
                        </td>
                    </tr>
                    {{ else }}
                    <tr>
                        <td colspan="9" class="px-6 py-12 text-center text-text-secondary">
                            <span class="material-symbols-outlined text-4xl mb-2">inbox</span>
                            <p>Tidak ada data ditemukan untuk periode ini.</p>
                        </td>
                    </tr>
                    {{ end }}
                </tbody>
                <tfoot>
                    <tr class="bg-card-dark font-bold text-white border-t-2 border-border-dark">
                        <td colspan="7" class="px-6 py-4 text-right">TOTAL BERAT BERSIH</td>
                        <td class="px-6 py-4 text-right font-mono text-success">{{ printf "%.0f" .TotalNetWeight }}</td>
                        <td class="px-6 py-4"></td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
</div>

{{ template "footer" . }}
